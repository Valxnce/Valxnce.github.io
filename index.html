<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MiniSocial — Frontend-Only Social App</title>
  <style>
    /* ----- Basic layout & theme ----- */
    :root{
      --primary:#1877f2;
      --bg:#f0f2f5;
      --card:#fff;
      --muted:#65676b;
      --radius:12px;
      --shadow: 0 6px 18px rgba(15,23,42,0.08);
      --maxw:1000px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Inter,system-ui,Segoe UI,Roboto,Arial;
      background:var(--bg);
      color:#111827;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    header{
      background:linear-gradient(90deg,var(--primary),#0057d9);
      color:white;
      padding:10px 16px;
      display:flex;
      align-items:center;
      gap:12px;
      position:sticky;
      top:0;
      z-index:5;
    }
    header .brand{font-weight:700; font-size:18px}
    header .search{
      margin-left:16px;
      flex:1;
    }
    .container{
      max-width:var(--maxw);
      margin:18px auto;
      display:grid;
      grid-template-columns:260px 1fr 300px;
      gap:16px;
      padding:0 12px;
    }
    @media(max-width:980px){
      .container{grid-template-columns:1fr; padding:12px}
      .rightpane{order:3}
      .leftpane{order:1}
      .main{order:2}
    }

    /* ----- cards ----- */
    .card{
      background:var(--card);
      border-radius:var(--radius);
      padding:12px;
      box-shadow:var(--shadow);
    }
    .leftpane .profile-pic{
      width:64px; height:64px; border-radius:50%;
      background:linear-gradient(135deg,#6EE7B7,#3B82F6);
      display:inline-flex; align-items:center; justify-content:center;
      color:white; font-weight:700;
      font-size:20px;
    }
    .muted{color:var(--muted)}
    .btn{
      display:inline-block; padding:8px 12px; border-radius:8px;
      background:var(--primary); color:white; border:none; cursor:pointer;
      box-shadow:0 6px 12px rgba(24,119,242,0.12);
    }
    .btn.secondary{background:transparent; color:var(--primary); border:1px solid rgba(24,119,242,0.12)}
    .center{text-align:center}

    /* ----- new post ----- */
    .new-post{display:flex; gap:12px; align-items:flex-start}
    .new-post textarea{flex:1; min-height:70px; resize:vertical; padding:8px; border-radius:10px; border:1px solid #e6e6e6}
    .post-actions{display:flex; gap:8px; align-items:center; margin-top:8px}

    /* ----- feed ----- */
    .feed .post{margin-bottom:12px; padding:12px; border-radius:10px; background:var(--card)}
    .post .meta{display:flex; gap:10px; align-items:center}
    .avatar{width:46px;height:46px;border-radius:50%;background:#ddd;display:inline-flex;align-items:center;justify-content:center;font-weight:700}
    .post img.media{max-width:100%; border-radius:8px; margin-top:8px}
    .post .actions{display:flex; gap:6px; margin-top:8px}
    .like-btn.active{color:#e0245e}

    /* ----- right pane ----- */
    .suggestion .user-row{display:flex; gap:10px; align-items:center; justify-content:space-between; padding:8px 0}
    .comment-list{margin-top:8px; border-top:1px solid #f0f0f0; padding-top:6px}

    /* small utilities */
    input[type="text"], input[type="search"]{padding:8px 10px; border-radius:8px; border:1px solid #e6e6e6; width:100%}
    .small{font-size:13px}
    .pill{background:#eef3ff;color:#084298;padding:4px 8px;border-radius:999px;font-size:12px}
    .timestamp{color:#9aa0a6;font-size:12px}
    a.link{color:var(--primary); text-decoration:none}
    footer{margin:30px 0; text-align:center; color:var(--muted); font-size:13px}
  </style>
</head>
<body>

  <header>
    <div class="brand">MiniSocial</div>

    <div class="search">
      <input id="globalSearch" type="search" placeholder="Search posts or users..." />
    </div>

    <div id="headerControls"></div>
  </header>

  <div class="container">
    <!-- left: profile & navigation -->
    <div class="leftpane">
      <div class="card" id="leftCard">
        <div id="leftProfileArea" class="center">
          <!-- filled by JS -->
        </div>
        <hr />
        <div style="display:flex; gap:8px; flex-wrap:wrap; justify-content:center">
          <button class="btn" onclick="navigateTo('#/feed')">Feed</button>
          <button class="btn secondary" onclick="navigateTo('#/explore')">Explore</button>
          <button class="btn secondary" onclick="navigateTo('#/profile')">My Profile</button>
        </div>
      </div>

      <div style="height:12px"></div>

      <div class="card">
        <div class="small muted">Your Stats</div>
        <div style="display:flex; gap:10px; margin-top:8px; justify-content:space-between">
          <div class="center">
            <div style="font-weight:700" id="statPosts">0</div>
            <div class="muted small">Posts</div>
          </div>
          <div class="center">
            <div style="font-weight:700" id="statFollowers">0</div>
            <div class="muted small">Followers</div>
          </div>
          <div class="center">
            <div style="font-weight:700" id="statFollowing">0</div>
            <div class="muted small">Following</div>
          </div>
        </div>
      </div>
    </div>

    <!-- main: feed / pages -->
    <main class="main">
      <div id="pageContent">
        <!-- pages injected here -->
      </div>
    </main>

    <!-- right: suggestions & notifications -->
    <aside class="rightpane">
      <div class="card">
        <div style="display:flex; justify-content:space-between; align-items:center">
          <div style="font-weight:700">Notifications</div>
          <div class="pill" id="notifCount">0</div>
        </div>
        <div id="notifications" style="margin-top:10px" class="small muted">No notifications yet.</div>
      </div>

      <div style="height:12px"></div>

      <div class="card suggestion">
        <div style="font-weight:700">Suggestions</div>
        <div id="suggestionsList" style="margin-top:8px"></div>
      </div>
    </aside>
  </div>

  <footer>
    Built with ❤️ by you — frontend demo (no backend). Use responsibly.
  </footer>

  <script>
    /*************************************************************************
     * MiniSocial - Frontend-only social app
     * Features:
     * - Simple mock auth (username only)
     * - localStorage persistence (users, posts, follows, comments, likes)
     * - Feed, profile, explore, search, notifications
     *
     * This is a single-file app for learning and prototyping. Extend as needed.
     *************************************************************************/

    /* ---------- Utilities ---------- */
    function uid(prefix='id'){ return prefix + '_' + Math.random().toString(36).slice(2,9) }
    function now(){ return new Date().toISOString() }
    function timeAgo(iso){
      const d = new Date(iso);
      const s = Math.floor((Date.now()-d.getTime())/1000);
      if(s < 60) return s + 's';
      if(s < 3600) return Math.floor(s/60)+'m';
      if(s < 86400) return Math.floor(s/3600)+'h';
      const days = Math.floor(s/86400);
      return days+'d';
    }
    function persist(){ localStorage.setItem('mini_social_db', JSON.stringify(DB)) }
    function loadDB(){
      const raw = localStorage.getItem('mini_social_db');
      if(!raw) {
        // seed example data
        const alice = {id: 'user_alice', username:'alice', name:'Alice Roy', bio:'Math lover and JEE aspirant', avatarColor:'#6EE7B7', joined: now()};
        const bob   = {id: 'user_bob', username:'bob', name:'Bob Singh', bio:'Coding & music', avatarColor:'#60A5FA', joined: now()};
        const carla = {id: 'user_carla', username:'carla', name:'Carla', bio:'Teacher', avatarColor:'#FCA5A5', joined: now()};
        const posts = [
          {id:uid('p'), author:alice.id, text:"Happy studying! Here's a trick for integrals...", media:null, created: now(), likes:[], comments:[]},
          {id:uid('p'), author:bob.id, text:"Made a mini math visualizer today. Feedback welcome!", media:null, created: now(), likes:[], comments:[]}
        ];
        const users = [alice,bob,carla];
        const follows = { [alice.id]: [bob.id], [bob.id]: [], [carla.id]: [] }; // who each user follows
        return {
          users, posts, follows, notifications: [], lastSessionUser: null
        };
      }
      return JSON.parse(raw);
    }

    /* ---------- Simple DB in-memory + localStorage ---------- */
    let DB = loadDB();

    // currently logged in user id (null if none)
    let currentUser = DB.lastSessionUser || null;

    /* ---------- Rendering helpers ---------- */
    function el(tag, attrs={}, children=''){
      const e = document.createElement(tag);
      for(const k in attrs){
        if(k==='onclick'){ e.addEventListener('click', attrs[k]) }
        else if(k==='html'){ e.innerHTML = attrs[k] }
        else e.setAttribute(k, attrs[k]);
      }
      if(typeof children === 'string') e.appendChild(document.createTextNode(children));
      else if(Array.isArray(children)) children.forEach(c => e.appendChild(typeof c === 'string' ? document.createTextNode(c) : c));
      else if(children instanceof Node) e.appendChild(children);
      return e;
    }

    /* ---------- Auth / Header ---------- */
    function updateHeader(){
      const root = document.getElementById('headerControls');
      root.innerHTML = '';
      if(currentUser){
        const u = getUser(currentUser);
        const btn = el('div', {class:'small muted'}, `Hi, ${u.name.split(' ')[0]}`);
        const logout = el('button', {class:'btn secondary', onclick: logout}, 'Logout');
        root.appendChild(btn);
        root.appendChild(logout);
      } else {
        const login = el('button', {class:'btn', onclick: ()=>showModalLogin()}, 'Login / Sign up');
        root.appendChild(login);
      }
      updateLeftProfile();
    }

    function showModalLogin(){
      const name = prompt('Enter your display name (e.g. Rahul Kumar)');
      if(!name) return;
      const username = prompt('Choose a short username (letters/numbers, lowercase). This will be your public handle:');
      if(!username) return;
      // ensure unique username
      if(DB.users.find(u => u.username === username)){
        alert('Username taken. Try again.');
        return;
      }
      const user = { id: uid('user'), username, name, bio:'', avatarColor: '#'+Math.floor(Math.random()*16777215).toString(16), joined: now() };
      DB.users.push(user);
      DB.follows[user.id] = [];
      currentUser = user.id;
      DB.lastSessionUser = currentUser;
      persist();
      updateHeader();
      navigateTo('#/profile');
    }

    function logout(){
      currentUser = null;
      DB.lastSessionUser = null;
      persist();
      updateHeader();
      navigateTo('#/feed');
    }

    /* ---------- Data helpers ---------- */
    function getUser(idOrUsername){
      if(!idOrUsername) return null;
      if(idOrUsername.startsWith('user_')) return DB.users.find(u => u.id === idOrUsername);
      return DB.users.find(u => u.username === idOrUsername || u.id === idOrUsername);
    }
    function getPostsForFeed(userId){
      // show posts from people you follow + your posts, sorted by time desc
      if(!userId) return DB.posts.slice().sort((a,b)=>b.created.localeCompare(a.created));
      const following = DB.follows[userId] || [];
      return DB.posts.filter(p => p.author === userId || following.includes(p.author)).sort((a,b)=>b.created.localeCompare(a.created));
    }
    function createPost(text, mediaDataURL){
      if(!currentUser){ alert('Please login to post'); return; }
      const post = { id: uid('p'), author: currentUser, text: text||'', media: mediaDataURL||null, created: now(), likes: [], comments: [] };
      DB.posts.unshift(post);
      persist();
      addNotification(`${getUser(currentUser).name} created a post`);
      renderCurrentPage();
    }
    function toggleLike(postId){
      if(!currentUser){ alert('Login to like'); return; }
      const p = DB.posts.find(x => x.id === postId);
      const idx = p.likes.indexOf(currentUser);
      if(idx === -1) p.likes.push(currentUser);
      else p.likes.splice(idx,1);
      persist();
      renderCurrentPage();
      addNotification(`${getUser(currentUser).name} liked a post`);
    }
    function addComment(postId, text){
      if(!currentUser){ alert('Login to comment'); return; }
      const p = DB.posts.find(x => x.id === postId);
      p.comments.push({ id: uid('c'), author: currentUser, text, created: now() });
      persist();
      renderCurrentPage();
      addNotification(`${getUser(currentUser).name} commented: "${text.slice(0,30)}"`);
    }
    function followToggle(targetUserId){
      if(!currentUser){ alert('Login to follow'); return; }
      if(currentUser === targetUserId) return;
      const arr = DB.follows[currentUser] || [];
      const idx = arr.indexOf(targetUserId);
      if(idx === -1) arr.push(targetUserId);
      else arr.splice(idx,1);
      DB.follows[currentUser] = arr;
      persist();
      renderCurrentPage();
      addNotification(`${getUser(currentUser).name} ${idx===-1 ? 'followed' : 'unfollowed'} ${getUser(targetUserId).name}`);
    }

    function addNotification(text){
      DB.notifications.unshift({ id: uid('n'), text, created: now(), read:false });
      if(DB.notifications.length > 40) DB.notifications.pop();
      persist();
      renderNotifications();
    }

    /* ---------- Rendering parts of UI ---------- */
    function updateLeftProfile(){
      const area = document.getElementById('leftProfileArea');
      area.innerHTML = '';
      if(currentUser){
        const u = getUser(currentUser);
        const avatar = el('div', {class:'profile-pic'}, u.name.split(' ').map(s=>s[0]).slice(0,2).join(''));
        avatar.style.background = u.avatarColor;
        const name = el('div', {}, u.name);
        const handle = el('div', {class:'muted small'}, '@'+u.username);
        const bio = el('div', {class:'muted small'}, u.bio || 'No bio yet');
        const edit = el('div', {style:'margin-top:8px'}, el('button',{class:'btn secondary', onclick: ()=>editProfile()}, 'Edit Profile'));
        area.appendChild(avatar); area.appendChild(document.createElement('br'));
        area.appendChild(name); area.appendChild(handle); area.appendChild(bio); area.appendChild(edit);
      } else {
        const txt = el('div', {}, 'Not logged in');
        const btn = el('div', {style:'margin-top:8px'}, el('button',{class:'btn', onclick: ()=>showModalLogin()}, 'Create Account'));
        area.appendChild(txt); area.appendChild(btn);
      }
      // stats
      document.getElementById('statPosts').innerText = DB.posts.filter(p => p.author === currentUser).length || 0;
      const followers = Object.keys(DB.follows || {}).filter(k => (DB.follows[k]||[]).includes(currentUser)).length;
      document.getElementById('statFollowers').innerText = followers;
      document.getElementById('statFollowing').innerText = (DB.follows[currentUser]||[]).length;
    }

    function renderNotifications(){
      const node = document.getElementById('notifications');
      const countNode = document.getElementById('notifCount');
      if(!DB.notifications.length){ node.innerHTML = '<div class="muted small">No notifications yet.</div>'; countNode.innerText='0'; return; }
      node.innerHTML = '';
      DB.notifications.slice(0,6).forEach(n => {
        const row = el('div', {class:'small'}, timeAgo(n.created) + ' — ' + n.text);
        node.appendChild(row);
      });
      const unread = DB.notifications.length;
      countNode.innerText = unread;
    }

    function renderSuggestions(){
      const target = document.getElementById('suggestionsList');
      target.innerHTML = '';
      // recommend random users not followed by currentUser
      const candidates = DB.users.filter(u => u.id !== currentUser && !(DB.follows[currentUser]||[]).includes(u.id));
      if(candidates.length ===0){
        target.innerHTML = '<div class="muted small">No suggestions</div>'; return;
      }
      shuffle(candidates).slice(0,4).forEach(u => {
        const row = el('div', {class:'user-row'});
        const left = el('div', {}, [
          el('div', {class:'avatar', style:'width:36px;height:36px;font-size:14px;background:'+u.avatarColor}, u.name.split(' ').map(s=>s[0]).slice(0,2).join('')),
          el('div', {style:'display:inline-block;margin-left:8px;vertical-align:middle'}, [el('div', {style:'font-weight:600'}, u.name), el('div',{class:'small muted'}, '@'+u.username)])
        ]);
        const followBtn = el('button', {class:'btn', onclick: ()=>{ followToggle(u.id); renderSuggestions(); }}, 'Follow');
        row.appendChild(left); row.appendChild(followBtn);
        target.appendChild(row);
      })
    }

    function shuffle(arr){ return arr.slice().sort(()=>Math.random()-0.5) }

    /* ---------- Pages ---------- */
    function renderFeedPage(){
      const content = document.getElementById('pageContent');
      content.innerHTML = '';

      const newPostCard = el('div', {class:'card new-post'}, [
        el('div', {style:'flex:1'}, [
          el('textarea', {id:'newPostText', placeholder:"What's happening?", style:'width:100%; min-height:70px; border-radius:10px; padding:8px; border:1px solid #e6e6e6'}, '')
        ]),
        el('div', {}, [
          el('input', {type:'file', id:'newPostMedia', accept:'image/*', onchange: handleMediaSelect}),
          el('div', {class:'post-actions'}, [
            el('button', {class:'btn', onclick: ()=>submitNewPost()}, 'Post'),
            el('button', {class:'btn secondary', onclick: ()=>{ document.getElementById('newPostText').value=''; document.getElementById('newPostMedia').value=''; }}, 'Clear')
          ])
        ])
      ]);
      content.appendChild(newPostCard);

      const feed = el('div', {class:'feed'}, '');
      const posts = getPostsForFeed(currentUser);
      posts.forEach(p => feed.appendChild(renderPost(p)));
      content.appendChild(feed);
    }

    function handleMediaSelect(e){
      // nothing: we will read file when posting
    }

    async function submitNewPost(){
      const text = document.getElementById('newPostText').value.trim();
      const fileInput = document.getElementById('newPostMedia');
      let dataURL = null;
      if(fileInput && fileInput.files && fileInput.files[0]){
        dataURL = await fileToDataURL(fileInput.files[0]);
      }
      if(!text && !dataURL){ alert('Add text or an image'); return; }
      createPost(text, dataURL);
      document.getElementById('newPostText').value='';
      fileInput.value='';
    }

    function fileToDataURL(file){
      return new Promise((res,rej)=>{
        const reader = new FileReader();
        reader.onload = () => res(reader.result);
        reader.onerror = rej;
        reader.readAsDataURL(file);
      })
    }

    function renderPost(p){
      const author = getUser(p.author);
      const post = el('div', {class:'post card'});
      const meta = el('div', {class:'meta'});
      const avatar = el('div', {class:'avatar', style:'background:'+author.avatarColor}, author.name.split(' ').map(s=>s[0]).slice(0,2).join(''));
      const authorInfo = el('div', {}, [
        el('div', {style:'font-weight:600'}, author.name + ' '), 
        el('div', {class:'muted small'}, '@'+author.username + ' • ' + timeAgo(p.created))
      ]);
      const followBtn = el('button', {class:'btn secondary', onclick: ()=>followToggle(author.id)}, DB.follows[currentUser] && DB.follows[currentUser].includes(author.id) ? 'Following' : 'Follow');

      meta.appendChild(avatar);
      meta.appendChild(authorInfo);
      meta.appendChild(el('div', {style:'flex:1'}));
      meta.appendChild(followBtn);

      post.appendChild(meta);
      if(p.text) post.appendChild(el('div', {style:'margin-top:8px'}, p.text));
      if(p.media) post.appendChild(el('img', {class:'media', src:p.media}));

      // actions
      const actions = el('div', {class:'actions'});
      const likeBtn = el('button', {class:'small like-btn', onclick: ()=>toggleLike(p.id)}, `❤️ ${p.likes.length}`);
      if(p.likes.includes(currentUser)) likeBtn.classList.add('active');
      const commentBtn = el('button', {class:'small', onclick: ()=>toggleCommentBox(p.id)}, `💬 ${p.comments.length}`);
      const shareBtn = el('button', {class:'small', onclick: ()=>{ navigator.clipboard?.writeText(location.href + '#/post/'+p.id); alert('Post link copied') }}, 'Share');
      actions.appendChild(likeBtn);
      actions.appendChild(commentBtn);
      actions.appendChild(shareBtn);
      post.appendChild(actions);

      // comment area
      const commentArea = el('div', {id:'carea_'+p.id, style:'display:none; margin-top:8px'});
      const commentInput = el('input', {type:'text', placeholder:'Write a comment...', style:'width:100%; padding:8px; border-radius:8px; border:1px solid #e6e6e6'});
      const cbtn = el('button', {class:'btn', onclick: ()=>{ addComment(p.id, commentInput.value); commentInput.value=''; }}, 'Comment');
      commentArea.appendChild(commentInput); commentArea.appendChild(el('div',{style:'height:6px'})); commentArea.appendChild(cbtn);

      // show comments
      const commentsList = el('div', {class:'comment-list'});
      p.comments.forEach(c => {
        const cu = getUser(c.author);
        const crow = el('div', {style:'padding:6px 0; border-bottom:1px dashed #f0f0f0'}, [
          el('div', {style:'font-weight:700; display:inline-block; margin-right:8px'}, cu.name),
          el('div', {class:'small muted', style:'display:inline-block'}, c.text),
          el('div', {class:'muted small', style:'margin-left:8px; display:block'}, timeAgo(c.created))
        ]);
        commentsList.appendChild(crow);
      });

      post.appendChild(commentArea);
      post.appendChild(commentsList);
      return post;
    }

    function toggleCommentBox(postId){
      const box = document.getElementById('carea_'+postId);
      if(!box) return;
      box.style.display = box.style.display === 'none' ? 'block' : 'none';
    }

    /* Profile page */
    function renderProfilePage(username){
      const content = document.getElementById('pageContent');
      content.innerHTML = '';

      let user;
      if(!username) user = getUser(currentUser);
      else user = DB.users.find(u => u.username === username || u.id === username);
      if(!user){ content.appendChild(el('div', {class:'card'}, 'User not found')); return; }

      const header = el('div', {class:'card'}, [
        el('div', {style:'display:flex; gap:12px; align-items:center'}, [
          el('div', {class:'avatar', style:'width:80px;height:80px;font-size:26px;background:'+user.avatarColor}, user.name.split(' ').map(s=>s[0]).slice(0,2).join('')),
          el('div', {}, [ el('div', {style:'font-weight:800; font-size:18px'}, user.name), el('div', {class:'muted small'}, '@'+user.username ), el('div', {style:'margin-top:6px'}, el('div', {class:'small muted'}, user.bio || 'No bio')) ])
        ])
      ]);
      content.appendChild(header);

      const followArea = el('div', {class:'card'}, [
        el('div', {}, [ el('div', {style:'font-weight:700'}, 'Connections'), el('div', {class:'small muted'}, `${Object.keys(DB.follows || {}).filter(k => (DB.follows[k]||[]).includes(user.id)).length} followers • ${(DB.follows[user.id]||[]).length} following`) ]),
        el('div', {style:'margin-top:8px'}, (currentUser !== user.id) ? el('button',{class:'btn', onclick: ()=>followToggle(user.id)}, (DB.follows[currentUser]||[]).includes(user.id) ? 'Unfollow' : 'Follow') : el('button',{class:'btn secondary', onclick: ()=>editProfile()}, 'Edit profile'))
      ]);
      content.appendChild(followArea);

      // posts by user
      const postWrap = el('div', {class:'card'}, [ el('div',{style:'font-weight:700'}, user.name + "'s posts"), el('div',{id:'userPosts'}) ]);
      content.appendChild(postWrap);
      const userPosts = DB.posts.filter(p => p.author === user.id).sort((a,b)=>b.created.localeCompare(a.created));
      const upnode = content.querySelector('#userPosts');
      if(userPosts.length ===0) upnode.appendChild(el('div',{class:'muted small'}, 'No posts yet'));
      userPosts.forEach(p => upnode.appendChild(renderPost(p)));
    }

    /* Explore page */
    function renderExplorePage(){
      const content = document.getElementById('pageContent');
      content.innerHTML = '';
      content.appendChild(el('div',{class:'card'}, el('div',{style:'font-weight:700'}, 'Explore')));
      const trending = el('div', {class:'card'}, el('div',{}, 'Trending posts'));
      // show top liked posts
      const top = DB.posts.slice().sort((a,b)=> b.likes.length - a.likes.length).slice(0,6);
      if(top.length===0) top.push(el('div',{class:'muted small'}, 'No posts yet'));
      top.forEach(p => trending.appendChild(renderPost(p)));
      content.appendChild(trending);

      // show users
      const usersCard = el('div', {class:'card'}, el('div', {style:'font-weight:700'}, 'Discover people'));
      DB.users.forEach(u => {
        usersCard.appendChild(el('div', {style:'padding:8px 0; border-bottom:1px solid #f0f0f0; display:flex; justify-content:space-between; align-items:center'}, [
          el('div', {}, [ el('div',{style:'font-weight:700'}, u.name), el('div',{class:'small muted'}, '@'+u.username) ]),
          el('button', {class:'btn', onclick: ()=>{ navigateTo('#/profile/'+u.username) }}, 'Visit')
        ]));
      });
      content.appendChild(usersCard);
    }

    /* Post page (single) */
    function renderPostPage(postId){
      const p = DB.posts.find(x => x.id === postId);
      const content = document.getElementById('pageContent');
      content.innerHTML = '';
      if(!p) { content.appendChild(el('div',{class:'card'}, 'Post not found')); return; }
      const postCard = renderPost(p);
      postCard.classList.add('card');
      content.appendChild(postCard);
    }

    /* ---------- Profile editing ---------- */
    function editProfile(){
      if(!currentUser) return alert('Login first');
      const u = getUser(currentUser);
      const name = prompt('Name', u.name);
      if(name) u.name = name;
      const bio = prompt('Bio', u.bio || '');
      if(bio !== null) u.bio = bio;
      persist();
      updateLeftProfile();
      renderCurrentPage();
    }

    /* ---------- Router & navigation ---------- */
    function navigateTo(hash){
      location.hash = hash;
    }
    function handleRoute(){
      const hash = location.hash || '#/feed';
      const parts = hash.split('/');
      updateHeader(); renderNotifications(); renderSuggestions();
      if(hash.startsWith('#/feed')) renderFeedPage();
      else if(hash.startsWith('#/explore')) renderExplorePage();
      else if(hash.startsWith('#/profile')){
        const username = parts[2];
        renderProfilePage(username);
      }
      else if(hash.startsWith('#/post')){
        const postId = parts[2];
        renderPostPage(postId);
      } else renderFeedPage();
    }
    window.addEventListener('hashchange', handleRoute);

    /* ---------- Search ---------- */
    document.getElementById('globalSearch').addEventListener('input', (e)=>{
      const q = e.target.value.trim().toLowerCase();
      if(!q) return;
      // show quick results overlay (simple)
      const users = DB.users.filter(u => u.name.toLowerCase().includes(q) || u.username.includes(q));
      const posts = DB.posts.filter(p => (p.text || '').toLowerCase().includes(q));
      const content = document.getElementById('pageContent');
      content.innerHTML = '';
      content.appendChild(el('div',{class:'card'}, [el('div',{style:'font-weight:700'}, `Search results for "${q}"`)]));
      const usersCard = el('div',{class:'card'}, [el('div',{style:'font-weight:700'}, 'Users')]);
      users.forEach(u => usersCard.appendChild(el('div',{style:'padding:8px 0; display:flex; justify-content:space-between; align-items:center'}, [ el('div',{}, [el('div',{style:'font-weight:700'}, u.name), el('div',{class:'muted small'}, '@'+u.username)]), el('button',{class:'btn', onclick: ()=>navigateTo('#/profile/'+u.username)}, 'View') ])));
      content.appendChild(usersCard);
      const postsCard = el('div',{class:'card'}, [el('div',{style:'font-weight:700'}, 'Posts')]);
      posts.forEach(p => postsCard.appendChild(renderPost(p)));
      content.appendChild(postsCard);
    });

    /* ---------- Initial setup & utilities ---------- */
    function renderCurrentPage(){ handleRoute(); updateLeftProfile(); renderSuggestions(); renderNotifications(); }
    function boot(){
      persist(); updateHeader(); renderCurrentPage();
      // handle direct hash to post or profile
      handleRoute();
    }

    // persist DB periodically to avoid accidental loss
    setInterval(persist, 2000);

    // expose some functions to console for debugging
    window.DB = DB;
    window.createPost = createPost;
    window.getUser = getUser;

    // start
    boot();

  </script>
</body>
</html>
